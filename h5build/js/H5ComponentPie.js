var H5ComponentPie=function(t,e){var n=new H5ComponentBase(t,e),a=e.width,o=e.height,i=document.createElement("canvas"),s=i.getContext("2d");i.width=s.width=a,i.height=i.height=o,$(i).css("zIndex",1),n.append(i);var c=a/2;s.beginPath(),s.fillStyle="#eee",s.strokeStyle="#eee",s.lineWidth=1,s.arc(c,c,c,0,2*Math.PI),s.fill(),s.stroke();var i=document.createElement("canvas"),s=i.getContext("2d");i.width=s.width=a,i.height=s.height=o,$(i).css("zIndex",2),n.append(i);for(var h=["red","green","blue","#a00","orange"],r=1.5*Math.PI,d=0,l=2*Math.PI,f=e.data.length,p=0;p<f;p++){var v=e.data[p],g=v[2]||(v[2]=h.pop());d=r+l*v[1],s.beginPath(),s.fillStyle=g,s.strokeStyle=g,s.lineWidth=.1,s.moveTo(c,c),s.arc(c,c,c,r,d),s.fill(),s.stroke(),r=d;var u=$('<div class="text"></div>');u.text(e.data[p][0]);var m=$('<div class="per"></div>');m.text(100*e.data[p][1]+"%"),u.append(m);var x=c+Math.sin(.3*Math.PI-r)*c,P=c+Math.cos(.3*Math.PI-r)*c;x>a/2?u.css("left",x/2):u.css("right",(a-x)/2+10),P>o/2?u.css("top",P/2):u.css("bottom",(o-P)/2),e.data[p][2]&&u.css("color",e.data[p][2]),u.css("opacity",0),n.append(u)}var i=document.createElement("canvas"),s=i.getContext("2d");i.width=s.width=a,i.height=s.height=o,$(i).css("zIndex",3),n.append(i),s.fillStyle="#eee",s.strokeStyle="#eee",s.lineWidth=1;var I=function(t){s.clearRect(0,0,a,o),s.beginPath(),s.moveTo(c,c),t<=0?(s.arc(c,c,c,0,2*Math.PI),n.find(".text").css("opacity",0)):s.arc(c,c,c,r,r+2*Math.PI*t,!0),s.fill(),s.stroke(),t>=1&&(n.find(".text").css("transition","all 0s"),H5ComponentPie.reSort(n.find(".text")),n.find(".text").css("transition","all 1s"),n.find(".text").css("opacity",1),s.clearRect(0,0,a,o))};return I(0),n.on("onLoad",function(){var t=0;for(p=0;p<100;p++)setTimeout(function(){t+=.01,I(t)},10*p+500)}),n.on("onLeave",function(){var t=1;for(p=0;p<100;p++)setTimeout(function(){t-=.01,I(t)},10*p)}),n};H5ComponentPie.reSort=function(t){var e=function(t,e){var n=$(t).offset(),a=$(e).offset(),o=[n.left,$(t).width()+n.left],i=[n.top,$(t).height()+n.top],s=[a.left,$(e).width()+a.left],c=[a.left,$(e).height()+a.top],h=o[0]>s[0]&&o[0]<s[1]||o[1]>s[0]&&o[1]<s[1],r=i[0]>c[0]&&i[0]<c[1]||i[1]>c[0]&&i[1]<c[1];return h&&r},n=function(t,e){"auto"!=$(t).css("top")&&$(t).css("top",parseInt($(t).css("top"))+$(e).height()),"auto"!=$(t).css("bottom")&&$(t).css("bottom",parseInt($(t).css("bottom"))+$(e).height())},a=[t[0]];$.each(t,function(t,n){e(a[a.length-1],n)&&a.push(n)}),a.length>1&&($.each(a,function(t,e){a[t+1]&&n(e,a[t+1])}),H5ComponentPie.reSort(a))};