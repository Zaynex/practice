{"version":3,"sources":["H5ComponentPolyline.js"],"names":["H5ComponentPolyline","name","cfg","draw","per","ctx","clearRect","w","h","beginPath","lineWidth","strokeStyle","x","y","row_w","data","length","i","item","moveTo","arc","Math","PI","lineTo","stroke","fillStyle","fill","font","fillText","component","H5ComponentBase","width","height","cns","document","createElement","getContext","append","step","text_w","text","$","css","on","setTimeout"],"mappings":"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","file":"H5ComponentPolyline.js","sourcesContent":["/* 柱图组件对象 */\r\n\r\nvar H5ComponentPolyline = function(name, cfg){\r\n  var component = new H5ComponentBase(name, cfg);\r\n\r\n  var w = cfg.width;\r\n  var h = cfg.height;\r\n\r\n  var cns = document.createElement('canvas');\r\n  var ctx = cns.getContext(\"2d\");\r\n  cns.width = ctx.width = w;\r\n  cns.height = ctx.height =h;\r\n  component.append(cns);\r\n\r\n  ctx.beginPath();\r\n  ctx.lineWidth = 1;\r\n  ctx.strokeStyle = \"#AAAAAA\";\r\n  var step = 10;//这里要加1是因为数值是在坐标点上的\r\n  for(var i = 0; i < step + 1; i++){\r\n    var y = (h/step) * i;\r\n    ctx.moveTo(0, y);\r\n    ctx.lineTo(w, y);\r\n  }\r\n  // ctx.stroke();\r\n  //垂直网格线\r\n  step = cfg.data.length + 1;\r\n  var text_w = w/step >> 0;\r\n  for(var i = 0; i < step + 1; i++){\r\n    var x = (w/step) * i;\r\n    ctx.moveTo(x, 0);\r\n    ctx.lineTo(x, h); \r\n    if(cfg.data[i]){\r\n      var text = $('<div class=\"text\"></div>');\r\n      text.text(cfg.data[i][0]);\r\n      text.css('width', text_w/2)\r\n        .css('left', x/2 + text_w/4);\r\n\r\n      component.append(text);\r\n    }\r\n  }\r\n\r\n  ctx.stroke();\r\n  \r\n  /**\r\n   * 折线图数据层\r\n   *@param  {float} per 0到1之间的数据，会根据这个值绘制最终数据对应的中间状态\r\n   * @return {DOM}     Component元素\r\n   */\r\n    var cns = document.createElement('canvas');\r\n    var ctx = cns.getContext(\"2d\");\r\n    cns.width = ctx.width = w;\r\n    cns.height = ctx.height =h;\r\n    component.append(cns);\r\n\r\n  //加入画布折线图数据\r\n \r\n  function draw(per){\r\n    \r\n   ctx.clearRect(0,0,w,h);\r\n\r\n\r\n\r\n    ctx.beginPath();\r\n    ctx.lineWidth = 3;\r\n    ctx.strokeStyle = \"#ff8878\";\r\n\r\n    var x = 0;\r\n    var y = 0;\r\n\r\n    var row_w = (w / (cfg.data.length + 1));\r\n    for(i in cfg.data){\r\n      var item = cfg.data[i];\r\n      // x = (w / cfg.data.length) * i;\r\n      x = row_w * i + row_w;\r\n      y = h - (item[1] * h * per);\r\n      ctx.moveTo(x, y);\r\n      ctx.arc(x, y, 5, 0, 2*Math.PI);\r\n    }\r\n    \r\n\r\n    //  移动画笔到第一个数据的点位置\r\n    ctx.moveTo(row_w, h-(cfg.data[0][1]* h * per ));\r\n    for(i in cfg.data){\r\n      var item = cfg.data[i];\r\n      x = row_w * i + row_w;\r\n      y = h -(item[1]* h * per);\r\n      ctx.lineTo(x, y);\r\n    }\r\n    ctx.stroke();\r\n    \r\n    //这里是为了把边线都给去掉了\r\n    ctx.strokeStyle = \"rgba(255, 255, 255, 0)\";\r\n   \r\n    //阴影\r\n    ctx.lineTo(x, h);\r\n    ctx.lineTo(row_w, h);\r\n    //填充背景颜色\r\n    ctx.fillStyle = 'rgba(255, 136, 120, 0.2)';\r\n    //收笔\r\n    ctx.fill();\r\n\r\n\r\n    //写数据\r\n    for(var i in cfg.data){\r\n      var item = cfg.data[i];\r\n      x = row_w * i + row_w;\r\n      y = h -(item[1] * h * per);\r\n      ctx.font = \"bold 1.9em Arial\";\r\n      ctx.fillStyle = typeof item[2] === 'string' ? item[2] : \"#595959\";\r\n      ctx.fillText( ( (item[1]*100)>>0) + \"%\", x-10, y-20);\r\n    }\r\n    ctx.stroke();\r\n\r\n  };\r\n\r\n    component.on('onLoad', function(){\r\n      //折线图生长动画\r\n      //优化折线生长动画，使用闭包\r\n      // var s = 0;\r\n      for(i = 0; i <100; i++){\r\n        (function(i){\r\n          setTimeout(function(){\r\n            // s += .01;\r\n            // draw(s);\r\n            draw(i/100);\r\n            // console.log(i);\r\n          }, i*10 + 500);\r\n        })(i)\r\n      }\r\n    });\r\n\r\n    component.on('onLeave', function(){\r\n      for(i = 0; i < 100; i++){\r\n        (function(i){\r\n          setTimeout(function(){\r\n            draw(1-i/100);\r\n          }, i*10);\r\n        })(i)\r\n      }\r\n    });\r\n\r\n    return component;\r\n  }"]}